<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.c4.hero.domain.payroll.adjustment.mapper.PayrollAdjustmentQueryMapper">

    <select id="sumApprovedAdjustmentNet" resultType="int">
        SELECT
            COALESCE(SUM(
                             CASE
                                 WHEN a.sign = '-' THEN -a.amount
                                 ELSE a.amount
                                 END
                     ), 0) AS net
        FROM tbl_payroll_adjustment a
                 JOIN tbl_payroll p
                      ON p.payroll_id = a.payroll_id
        WHERE p.employee_id = #{employeeId}
          AND a.effective_month = #{salaryMonth}
          AND a.status = 'APPROVED'
    </select>

</mapper>
